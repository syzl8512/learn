# 详细项目设计文档 V2 - 快速参考（1页总结）

**生成日期**: 2025-10-25
**版本**: 2.0 - 完整可执行设计方案
**关键改动**: 6项技术调整已全部集成

---

## 🎯 核心改变 - 从 V1 到 V2

| 维度 | V1 | V2 | 影响 |
|-----|----|----|------|
| **难度等级** | 5级（Easy/Medium/Hard/Advanced/Expert） | 4级（初级/KET/PET/自定义）+ 蓝斯值 | 精准用户分层 |
| **前端框架** | React 19 + Taro | Vue 3 + Taro | 微信适配更优化 |
| **AI服务** | OpenAI GPT-4 | DeepSeek API | 国内无需VPN |
| **语音合成** | Google TTS | Aliyun TTS | 国内可用 |
| **蓝斯值获取** | API自动判定 | 3种方式（快速选/手动入/AI判） | 灵活多样 |
| **听力导入** | 单条输入 | Excel/CSV批量导入 | 大规模快速部署 |

---

## 📊 难度分级系统 (V2 新增)

```
档次    蓝斯值范围  特点            推荐年龄
─────────────────────────────────────────
初级    400-600L   基础词、简单句   6-8岁
KET     600-900L   常用词、基本句   8-10岁
PET     900-1200L  学术词、复杂句   10-12岁
自定义  用户指定   精准匹配        灵活
```

**蓝斯值获取3种流程**:
```
方式1: 快速选择 → 初级/KET/PET (预设蓝斯值范围)
方式2: 手动输入 → 客户明确输入精确蓝斯值 (如: 750L)
方式3: AI判断 → 上传已掌握单词 → DeepSeek分析 → 推荐蓝斯值
```

**获取蓝斯值网址**:
- 官方: https://www.lexile.com/find-a-book/
- 备选: https://www.readinglevel.com/

---

## 🎙️ 听力导入系统 (V2 新增)

**快速导入流程**:
```
Excel/CSV (批量上传)
    ↓
字段验证 (话题/难度/标题/音频URL/文本)
    ↓
音频处理 (下载/转码/检验)
    ↓
内容提取 (TTS/字幕/翻译)
    ↓
数据入库 (ListeningContent + 相关表)
```

**Excel 模板示例**:
```
话题       | 难度  | 标题    | 时长(秒) | 音频URL      | 文本内容 | 中文翻译 | 内容类型
───────────┼──────┼────────┼──────────┼─────────────┼────────┼────────┼────────
日常生活   | 初级 | 早上问候 | 120     | https://... | Good... | 早上好... | dialogue
科技创新   | KET  | 手机史  | 180     | https://... | The...  | 手机历史...| narrative
```

---

## 🏗️ 技术架构调整 (V2)

### 前端栈
- **框架**: Vue 3 + TypeScript
- **编译**: Taro 4.x (支持微信、H5、支付宝等)
- **状态管理**: Pinia
- **样式**: UnoCSS / Tailwind CSS
- **HTTP**: axios

### 后端栈
- **框架**: NestJS 10.x + TypeScript
- **数据库**: PostgreSQL 16 + Prisma ORM
- **缓存**: Redis
- **认证**: JWT + 微信登录

### AI服务 (国内版)
- **文本生成**: DeepSeek Chat API
- **难度评估**: DeepSeek (提示词工程)
- **语音合成**: 阿里云 TTS (Primary) / 腾讯云 TTS (Backup)
- **词义查询**: 内置词库 + 第三方词典API

---

## 💾 数据库核心改动

### User 表新增字段
```sql
lexileScore        FLOAT          -- 蓝斯值
lexileLevel        VARCHAR(20)    -- 初级/KET/PET/自定义
assessmentMethod   VARCHAR(20)    -- manual/ai/uploaded_words
```

### Chapter 表多版本内容
```sql
originalContent         TEXT    -- 原文
easyAdaptedContent      TEXT    -- 初级版 (600-800L)
ketAdaptedContent       TEXT    -- KET版 (800-1000L)
petAdaptedContent       TEXT    -- PET版 (1000-1200L)
customAdaptedContent    TEXT    -- 自定义版本
```

### 新增 LexileAssessment 表
```sql
id               STRING (PK)
userId           STRING (FK)
method           VARCHAR(20)    -- manual/ai/uploaded_words
minLexile        FLOAT
maxLexile        FLOAT
recommendedLevel VARCHAR(20)
createdAt        DATETIME
```

### ListeningContent 表新增字段
```sql
importBatchId    STRING         -- 批导入标识
importedAt       DATETIME       -- 导入时间
importedBy       STRING (FK)    -- 导入用户
```

---

## 🚀 开发路线图 V2

| Phase | 时间 | 核心任务 | 关键迭代 |
|-------|------|--------|---------|
| **P1** | 4周 | 后端框架 + 前端基础 + 认证 | NestJS + Vue + 微信登录 |
| **P2** | 6周 | AI难度适配 + 多版本生成 | DeepSeek集成 + 4档难度 |
| **P3** | 4周 | **听力导入系统** + 听力训练 | Excel导入 + 快速部署 |
| **P4** | 3周 | 后台管理 + 优化 | 审核工具 + 性能调优 |
| **P5** | 2周 | 测试 + 部署 | 完整联调 + 上线 |

**P3重点**: 听力材料批量导入是这一阶段的核心，支持快速扩展内容库。

---

## ❌ 已移除的功能/方案

1. **不复用 atomic 能力** - 从零开始实现所有功能，避免依赖问题
2. **Lexile 自动评估 API** - 只提供网址，让用户自己查询或上传词汇让AI判定
3. **5级难度系统** - 替换为更清晰的4档系统
4. **React/Ant Design 前端** - 改为 Vue + Taro 更好适配微信
5. **OpenAI/Google 服务** - 改为 DeepSeek/Aliyun 国内可用方案

---

## 📌 设计亮点

### ✨ 灵活的蓝斯值系统
- 预设快速选择 (初级/KET/PET)
- 手动精确输入 (自定义蓝斯值)
- AI智能判定 (基于已掌握单词)
- 随时修改 (个人中心可调整)

### ✨ 高效的听力内容部署
- Excel/CSV 一次导入数百条
- 自动验证 + 错误提示
- 音频处理 + 字幕生成 (可选)
- 立即发布 (无需手动操作)

### ✨ 国内无障碍部署
- 所有AI服务可在国内使用 (无需VPN)
- 国产TTS (阿里云)，音质优秀
- DeepSeek API 文档完整，开发友好
- 支持离线词库 (可选)

---

## 🎯 与原需求的对应关系

| 原需求 | V2 实现 | 核心算法 |
|--------|--------|---------|
| 原版书籍处理 | ✅ 多版本适配 | 上传 → DeepSeek转写 → 4档输出 |
| 分册管理 | ✅ 章节树结构 | 按难度自动分册展示 |
| AI难度适配 | ✅ 4档 + 自定义 | Lexile蓝斯值精准分层 |
| 听力训练 | ✅ 完整模块 | 6话题 + 4难度 + 快速导入 |
| 词汇学习 | ✅ 生词本系统 | 点击查词 + 复习 + Anki导出 |
| 进度追踪 | ✅ 热力图 + 统计 | 自动保存 + 学习数据分析 |

---

## 📋 验收标准 (快速清单)

**功能**:
- [ ] 蓝斯值选择/输入/AI判定 3种流程可用
- [ ] 书籍生成4个适配版本 (初级/KET/PET/自定义)
- [ ] Excel 批导入听力内容 (≥100条)
- [ ] 听力模块 6话题 + 4难度分类
- [ ] 生词本点击收藏 + 导出Anki

**技术**:
- [ ] 所有服务在国内可用 (DeepSeek/Aliyun/微信)
- [ ] 不依赖 atomic 包，独立实现
- [ ] 页面加载 < 2秒 (4G网络)
- [ ] 小程序主包 < 2MB

---

## 🔗 相关文档

- **完整设计**: discuss/详细项目设计文档-v2.md (3500+行)
- **原需求**: 项目需求文档.md
- **参考方案**: aidarrett_analysis.md
- **初始化清单**: docs/项目初始化清单.md
- **全局指南**: CLAUDE.md

---

**下一步**:
1. 核对本总结，确认 6项调整都已理解
2. 审阅完整 V2 文档的核心章节
3. 启动 Phase 1 初始化工作 (后端 + 前端框架)
4. 创建 API 规范 + 启动脚本

**最后更新**: 2025-10-25 v2.0
**状态**: ✅ 完整可执行设计方案
