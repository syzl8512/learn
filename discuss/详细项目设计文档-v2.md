# 智慧儿童英文辅助阅读平台 - 详细项目设计文档 V2

**文档状态**: 优化设计方案
**创建日期**: 2025-10-25
**版本**: 2.0
**核心调整**:
- ✅ 去除 atomic 能力复用，完全独立开发
- ✅ 难度分级调整为 4 个档次 + 自定义蓝斯值
- ✅ 前端框架改为 Vue 以适配微信小程序
- ✅ AI 服务使用 DeepSeek（国内可用）
- ✅ 所有 AI 能力确保国内可用
- ✅ 听力材料支持快速导入

---

## 📋 目录

1. [执行摘要](#执行摘要)
2. [用户需求分析](#用户需求分析)
3. [产品功能架构](#产品功能架构)
4. [难度分级系统](#难度分级系统)
5. [AI 能力详解](#ai-能力详解)
6. [交互设计方案](#交互设计方案)
7. [后台管理系统](#后台管理系统)
8. [技术实现方案](#技术实现方案)
9. [数据库设计](#数据库设计)
10. [开发路线图](#开发路线图)
11. [验收标准](#验收标准)

---

## 执行摘要

### 项目目标

**智慧儿童英文辅助阅读平台** 是一个 AI 驱动的儿童英文学习系统，融合以下核心能力：

1. **智能难度适配** - 根据蓝斯值自动转写原版英文书籍
2. **精准蓝斯值定级** - 支持多种方式获取用户精准难度
3. **智能话题分类与生成** - AI 自动生成相关话题和学习资源
4. **沉浸式听力训练** - 结合音频、文本、字幕的多维听力体验
5. **完整的学习辅助体系** - 词义查询、生词管理、进度跟踪
6. **强大的后台管理** - PDF 上传、内容审核、快速导入听力

### 核心创新

- 🎯 **4 档难度 + 自定义蓝斯值** - 满足不同用户的精细化需求
- 🔄 **多维蓝斯值获取方式** - AI 判定或手动输入
- 🎵 **听力材料批量导入** - 支持快速构建听力库
- 🌍 **国内友好** - DeepSeek AI + 国内可用语音服务
- 📱 **Vue + Taro 多端适配** - 专为微信小程序优化

---

## 用户需求分析

### 1. 儿童用户需求

#### 阅读学习
| 需求 | 说明 | 优先级 |
|------|------|--------|
| 原版书籍阅读 | 展示原版英文内容，支持章节浏览 | P0 |
| 难度自适应 | 自动显示适配版本（按用户蓝斯值） | P0 |
| 原文/适配版切换 | 随时对比学习 | P1 |
| 音频朗读 | AI 语音播放，支持语速调节 | P1 |

#### 听力训练
| 需求 | 说明 | 优先级 |
|------|------|--------|
| 分类学习 | 按话题分类（日常、科学、文化等） | P0 |
| 难度分级 | 初级/KET/PET/自定义，5 个难度等级 | P0 |
| 专注模式 | 逐句显示，隐藏英文/中文进行训练 | P1 |
| 字幕同步 | 音频与文本实时同步 | P1 |
| 语速控制 | 0.75x - 1.5x 多档调节 | P1 |

#### 词汇学习
| 需求 | 说明 | 优先级 |
|------|------|--------|
| 点击查词 | 点击任意单词即可查看释义 | P0 |
| 生词本 | 保存生词，支持分类和导出 | P0 |
| 词义详解 | 词性、音标、例句、同义词 | P1 |
| 遗忘曲线复习 | 智能复习提醒 | P2 |

#### 学习进度
| 需求 | 说明 | 优先级 |
|------|------|--------|
| 进度记录 | 自动保存阅读位置和学习进度 | P0 |
| 学习数据 | 统计学习时长、完成度、掌握单词数 | P1 |
| 成就系统 | 徽章、等级、成就解锁 | P2 |

### 2. 教师/家长需求

| 需求 | 说明 | 优先级 |
|------|------|--------|
| 学生管理 | 添加班级学生，分配学习任务 | P0 |
| 学习监督 | 查看学生学习进度和成绩 | P1 |
| 内容推荐 | 根据学生水平推荐合适内容 | P2 |
| 报告导出 | 生成学习报告，支持 PDF 导出 | P2 |

### 3. 运营管理需求

| 需求 | 说明 | 优先级 |
|------|------|--------|
| 书籍管理 | 上传、编辑、删除书籍信息 | P0 |
| PDF 处理 | 自动 PDF → Markdown 转换 | P0 |
| AI 适配 | 触发 AI 难度适配和话题生成 | P0 |
| 听力导入 | **快速导入听力材料（Excel/CSV）** | P0 |
| 内容审核 | 审核 AI 生成的适配内容和话题 | P1 |
| 数据统计 | 用户数、学习量、内容量等 | P1 |

---

## 产品功能架构

### 1. 产品结构总览

```
智慧儿童英文辅助阅读平台
│
├─ 儿童学习端（微信小程序 - Vue）
│  ├─ 蓝斯值获取模块
│  │  ├─ 初级 (400-600L)
│  │  ├─ KET (600-900L)
│  │  ├─ PET (900-1200L)
│  │  └─ 自定义 (用户输入或 AI 判定)
│  │
│  ├─ 书籍阅读模块
│  │  ├─ 书籍列表
│  │  ├─ 章节阅读页（核心）
│  │  └─ 原文/适配版切换
│  │
│  ├─ 听力训练模块
│  │  ├─ 话题分类浏览
│  │  ├─ 难度分级选择
│  │  ├─ 音频播放器
│  │  └─ 专注模式
│  │
│  ├─ 词汇学习模块
│  │  ├─ 生词本管理
│  │  ├─ 点击查词
│  │  └─ 词义详解
│  │
│  └─ 个人中心
│     ├─ 学习进度
│     ├─ 蓝斯值管理
│     └─ 设置
│
├─ 教师/家长端
│  ├─ 学生管理
│  ├─ 学习监督
│  └─ 报告导出
│
└─ 后台管理系统（React）
   ├─ 书籍管理
   ├─ 听力材料管理 + 快速导入
   ├─ AI 适配管理
   ├─ 用户管理
   └─ 系统配置
```

### 2. 阅读模块 - 详细功能

#### 2.1 书籍列表页

**功能设计**:
- 展示所有可用书籍
- 按难度等级筛选（初级/KET/PET/自定义）
- 搜索和排序（最近、热门、高分）
- 显示书籍信息：封面、标题、作者、蓝斯值、章节数、推荐年龄

#### 2.2 章节阅读页 - 核心交互设计

**用户蓝斯值流程**:
```
首次使用:
  ├─ 选择快速档次（初级/KET/PET）
  │  └─ 或输入自定义蓝斯值
  │  └─ 或上传已掌握单词 → AI 判定蓝斯值
  │
  ├─ 获得精准蓝斯值后
  │  └─ 系统自动显示匹配的书籍版本
  │
  └─ 可随时在个人中心修改蓝斯值

后续阅读:
  ├─ 系统记住用户蓝斯值
  └─ 自动展示匹配的适配版本
```

**阅读页面交互**:

```
┌─────────────────────────────────────┐
│  <返回 书籍标题 > 第3章 / 总10章     │ 顶部导航
├─────────────────────────────────────┤
│                                       │
│  [原版]  [适配版]  [音频]           │ 内容切换标签
│                                       │
│  The old man walked slowly...        │ 正文内容
│  老人缓慢地走着...                   │ (可点击单词查词)
│                                       │
│  [❤] [🔖] [▶ 朗读] [🔧 工具]        │ 工具栏
│                                       │
├─────────────────────────────────────┤
│ 进度: ████████░░░░░░░░░ 40%         │ 进度条
└─────────────────────────────────────┘
```

**核心功能**:

1. **智能版本显示**
   - 根据用户蓝斯值自动选择合适版本
   - 支持手动切换到其他版本对比学习

2. **原文/适配版对比**
   - 两个版本并排展示（可滑动）
   - 支持逐段对比，理解难度差异

3. **智能朗读**
   - 点击 "▶ 朗读" 启动音频播放
   - 支持语速调节：0.75x、1x、1.25x、1.5x
   - 文本高亮跟随音频
   - 暂停/继续控制

4. **点击查词**
   - 用户点击任意单词 → 弹出词义窗口
   - 显示：音标、词性、中文释义、例句
   - "添加生词" 按钮

5. **生词收藏**
   - 点击 ❤ 按钮快速收藏单词
   - 同步到个人生词本

#### 2.3 蓝斯值获取与管理

**4 个难度档次定义**:

```
档次        蓝斯值范围    推荐年龄    特点
──────────────────────────────────────
初级        400-600L      6-8岁      基础词汇，简单句式
KET         600-900L      8-10岁     常用词汇，基本故事
PET         900-1200L     10-12岁    学术词汇，复杂句子
自定义      用户指定      灵活       精准适配
```

**蓝斯值获取方式**:

**方式 1：快速选择档次**
```
初级 KET PET
 ↓   ↓   ↓
快速设定，无需额外操作
```

**方式 2：手动输入蓝斯值**
```
输入框: [ 850 ] L
确认 → 系统自动推荐书籍
```

**方式 3：AI 自动判定 (可选)**
```
1. 用户上传已掌握的单词列表
   (可以是学过的书籍内容或单词表)

2. DeepSeek AI 分析单词难度

3. 系统计算平均蓝斯值

4. 显示推荐蓝斯值范围
   "根据你的单词水平，建议设定为 750-850L"
```

**重要说明**:
- ❌ 系统 **不提供其他方式的蓝斯值定级接口**
- ✅ 系统**提供蓝斯值查询工具的网址链接**
  - 如：Lexile.com 蓝斯值查询工具
  - 用户可自行查询书籍的蓝斯值

**蓝斯值修改入口**:
- 个人中心 → "我的蓝斯值" → 修改
- 支持随时调整，系统自动重新推荐书籍

---

## 难度分级系统

### 1. 整体难度架构

```
用户蓝斯值 (User Lexile)
  │
  ├─ 初级 (400-600L)    → 简易版本 (600-800L)
  ├─ KET (600-900L)     → 基础版本 (800-1000L)
  ├─ PET (900-1200L)    → 标准版本 (1000-1200L)
  └─ 自定义 (xxx L)      → 精准适配版本
```

### 2. 书籍和听力难度映射

**书籍难度**:
```
每本书自动计算蓝斯值范围，如:
- 书籍 A: 原始蓝斯值 950L
  ├─ 简易版 (650L) - 适合初级用户
  ├─ 基础版 (800L) - 适合 KET 用户
  ├─ 标准版 (950L) - 适合 PET 用户
  └─ 完整版 (950L) - 原文（用户自选）
```

**听力难度**:
```
听力内容按 5 个难度级别组织:
- 初级 Easy (600-750L)
- KET Medium (750-950L)
- PET Hard (950-1100L)
- Advanced (1100-1300L)
- Expert (1300L+)

用户选择对应难度学习
```

---

## AI 能力详解

### 1. AI 技术选型 - DeepSeek

**为什么选择 DeepSeek**:
- ✅ 国内可用，无需科学上网
- ✅ API 调用速度快，成本低
- ✅ 中文理解能力强
- ✅ 支持结构化输出（JSON）

**关键配置**:
```
API 提供商: DeepSeek
模型: deepseek-chat
API Base: https://api.deepseek.com/v1
文档: https://platform.deepseek.com/api-docs
```

### 2. AI 蓝斯值评估

#### 2.1 功能说明
- 用户上传已掌握的单词或文本
- DeepSeek 分析难度
- 系统计算推荐蓝斯值范围

#### 2.2 实现流程

```python
def assess_lexile_from_words(words: List[str]) -> LexileResult:
    """
    基于用户掌握的单词判断蓝斯值
    """
    prompt = f"""
    用户已掌握以下英文单词:
    {', '.join(words)}

    请分析这些单词的难度水平，并推荐蓝斯值范围。

    考虑因素：
    1. 单词难度（基础词/学术词/专业词）
    2. 单词数量和多样性
    3. 推荐的蓝斯值范围

    返回 JSON 格式:
    {{
      "average_lexile": 750,
      "min_lexile": 700,
      "max_lexile": 800,
      "recommended": "KET (600-900L)",
      "analysis": "基于你掌握的词汇..."
    }}
    """

    response = deepseek_client.call(prompt)
    return parse_lexile_result(response)
```

### 3. AI 内容转写

#### 3.1 多版本生成策略

对于每本上传的书籍：

```
原始版本 (原始蓝斯值)
  ↓
[AI 转写]
  ├─ 简易版 (600-800L)    → 初级用户 (6-8岁)
  ├─ 基础版 (800-1000L)   → KET用户 (8-10岁)
  ├─ 标准版 (1000-1200L)  → PET用户 (10-12岁)
  └─ 自定义版本 (用户蓝斯值)
```

#### 3.2 转写原则

**保持**（不改变）:
- ✅ 故事情节和逻辑
- ✅ 人物特征和对话风格
- ✅ 关键信息和知识点
- ✅ 文本总长度（±10%）

**修改**（简化难度）:
- 拆分长句为短句
- 替换生僻词为常用词
- 简化复杂语法结构
- 删除不必要的修饰词

#### 3.3 转写算法

```python
def adapt_content(
    original_text: str,
    target_lexile: float,
    current_lexile: float
) -> str:
    """
    将英文内容适配到目标蓝斯值
    """
    if current_lexile <= target_lexile:
        return original_text  # 已满足难度要求

    prompt = f"""
    请将以下英文内容改写为蓝斯值 {target_lexile}L 的版本。

    改写原则：
    1. 保持故事情节和人物特征完全一致
    2. 拆分复杂句式，使用更简单的语法
    3. 替换难词：{generate_difficult_words(original_text)}
    4. 文本长度保持在 ±10% 范围内
    5. 保留对话和关键信息

    原文：
    {original_text}

    请输出改写后的版本，确保简洁易懂，但保留原意。
    """

    adapted = deepseek_client.call(prompt)

    # 验证蓝斯值
    verified_lexile = assess_lexile(adapted)
    if abs(verified_lexile - target_lexile) > 50:
        # 递归优化
        return adapt_content(adapted, target_lexile, verified_lexile)

    return adapted
```

### 4. AI 话题分类与生成

#### 4.1 话题分类算法

```python
def extract_and_generate_topics(
    book_text: str,
    book_metadata: dict
) -> List[Topic]:
    """
    从书籍内容中提取主题，并生成相关听力题目
    """
    prompt = f"""
    分析以下书籍，提取其核心话题并生成相关学习资源。

    书籍信息：
    - 书名：{book_metadata['title']}
    - 作者：{book_metadata['author']}

    内容片段（前1000字）：
    {book_text[:1000]}

    请：
    1. 识别3-5个主要话题（从以下分类中选择）：
       - 日常生活、科技创新、历史文化、自然科学、社会文化、哲学思辨、运动健康

    2. 对于每个话题，生成：
       - 话题名称和描述
       - 3-5个相关的听力讨论题目
       - 10个相关的关键词汇

    3. 返回 JSON 格式
    """

    topics = deepseek_client.call(prompt)
    return parse_topics(topics)
```

#### 4.2 6 大话题体系

参考 aidarrett 的成功分类：

| 话题分类 | 包含内容 | 听力材料类型 |
|---------|---------|----------|
| **日常生活** | 家庭、学校、购物、娱乐 | 日常对话、故事 |
| **科技创新** | 手机、互联网、AI、太空 | 科技讨论、采访 |
| **历史文化** | 历史事件、传统文化、艺术 | 历史讲述、文化探讨 |
| **自然科学** | 生物、物理、化学、生态 | 科学解释、实验讨论 |
| **社会文化** | 社会问题、多元文化、礼仪 | 社会话题讨论 |
| **哲学思辨** | 人生价值、道德伦理 | 哲学讨论、故事分享 |

---

## 听力材料快速导入

### 1. 导入数据格式

#### 1.1 Excel/CSV 导入模板

```
话题,难度,标题,时长(秒),音频URL,文本内容,中文翻译,内容类型
日常生活,初级,早上的问候,120,https://...,Good morning...,早上好...,dialogue
科技创新,KET,手机发展史,180,https://...,The history of...,手机的历史...,narrative
历史文化,PET,中国古代建筑,240,https://...,Ancient Chinese...,古代中国...,discussion
```

#### 1.2 导入流程

```
后台管理 → 听力管理 → "批量导入" 按钮
  ↓
选择 Excel/CSV 文件
  ↓
预览数据（显示即将导入的记录数）
  ↓
验证音频 URL 可用性
  ↓
确认导入 → 后台处理
  ↓
导入完成，显示成功/失败统计
```

#### 1.3 导入验证规则

```
必填字段检查：
✓ 话题（必须是预定义的 6 大话题）
✓ 难度（初级/KET/PET/Advanced/Expert）
✓ 标题（非空）
✓ 时长（正数）
✓ 音频URL（可访问）
✓ 文本内容（非空）

可选字段：
- 中文翻译
- 内容类型（dialogue/narrative/discussion/interview）

验证失败处理：
显示具体错误行号和原因，允许修复后重新导入
```

#### 1.4 音频文件处理

**支持的音频格式**:
- MP3、WAV、AAC、OGG

**音频存储方案**:
- 本地存储：`/uploads/audio/listening/`
- 或使用阿里云 OSS（推荐）

**音频优化**:
- 自动转换为 MP3 (128kbps)
- 预生成不同语速版本 (0.75x, 1.0x, 1.25x, 1.5x)
- 缓存 CDN 加速

### 2. 导入后的处理

```
导入成功后：
  ↓
1. 自动生成字幕时间戳
   (通过 AI 语音识别或手动上传)

2. 提取关键词汇
   (DeepSeek 分析听力文本)

3. 难度验证
   (计算蓝斯值，确保准确)

4. 发布待审核状态
   (管理员审核后才能用户使用)
```

---

## 交互设计方案

### 1. 微信小程序适配（Vue）

**技术选型原因**:
- ✅ Vue 3 + TypeScript 语法简洁
- ✅ Taro / uni-app 支持 Vue 编译到小程序
- ✅ 相比 React，更容易写出高性能小程序
- ✅ 学习曲线平缓，团队上手快

**框架选择**:
```
前端框架: Vue 3 + TypeScript
小程序框架: Taro 4.x / uni-app 3.x
状态管理: Pinia (Vue 官方推荐)
HTTP 客户端: axios
样式: UnoCSS / Tailwind CSS for Vue
```

#### 1.1 页面栈管理
```
书籍列表 (index)
  ↓ 点击书籍
章节列表 (chapters)
  ↓ 点击章节
章节阅读 (reading)
  ├─ 点击单词 → 词义弹窗（不新增页面）
  ├─ 点击生词本 → 进入生词本页面
  └─ 返回 → 回到列表

听力训练列表 (listening)
  ↓ 点击训练
听力训练页 (training)
  └─ 返回 → 回到列表
```

#### 1.2 触控交互优化
- **长按查词** - 选中单词后长按显示释义
- **滑动操作** - 左滑回到前一页，右滑看下一章
- **底部工具栏** - 朗读、书签、工具菜单，大按钮易点击
- **进度条拖拽** - 支持拖拽快速调整阅读位置

#### 1.3 性能优化
- **分页加载** - 章节内容按 500 字分段加载
- **图片懒加载** - 书籍封面、配图延迟加载
- **缓存策略** - 当前章节完整加载，前后各预加载 1 章
- **离线支持** - 已阅读章节缓存本地，支持离线浏览

### 2. 国内友好的语音服务

**语音合成选项**:

| 选项 | 优点 | 缺点 | 推荐 |
|------|------|------|------|
| **阿里云 TTS** | 国内快、中文好 | 成本较高 | ⭐⭐⭐ 首选 |
| **腾讯云 TTS** | 质量高、国内可用 | 成本中等 | ⭐⭐ |
| **百度语音** | 成本低、功能多 | 质量一般 | ⭐⭐ |
| **Google TTS** | 质量最好 | 国内不稳定 | ❌ 不推荐 |

**推荐方案**:
```
主方案: 阿里云 TTS + 本地缓存
备用方案: 腾讯云 TTS

配置:
1. 预生成常用章节的音频
2. 按需生成其他内容
3. 生成 4 种语速版本并缓存
4. CDN 加速分发
```

**字幕同步实现**:
```
文本 → 分句处理 → 使用 TTS 获得音频时长信息
        ↓
[00:00.000] The old man...
[00:04.500] walked slowly...
[00:08.200] through the ...
        ↓
音频播放时，根据当前时间戳高亮对应文本
```

---

## 后台管理系统

### 1. 核心功能模块

#### 1.1 书籍管理

**工作流程**:
```
1. 上传书籍信息
   ├─ 标题、作者、出版社
   ├─ 描述、封面、类别
   └─ 推荐年龄

2. [等待 PDF]
   ↓
3. [自动 PDF → Markdown]（MinerU）
   ↓
4. [AI 难度适配 + 话题生成]（DeepSeek）
   ├─ 自动生成 3 个难度版本
   ├─ 计算蓝斯值
   └─ 提取话题

5. [人工审核]
   ├─ 检查适配质量
   ├─ 确认话题相关性
   └─ 编辑或重新生成

6. [发布]
   ↓
7. [用户可见]
```

#### 1.2 **听力材料快速导入**（新增）

**批量导入界面**:
```
后台管理 → 听力管理 → "批量导入"
  ↓
1. 下载导入模板 (Excel)

2. 填充数据:
   - 话题、难度、标题
   - 时长、音频 URL、文本、翻译

3. 上传文件

4. 系统验证:
   ✓ 字段完整性
   ✓ 音频 URL 可用性
   ✓ 难度合法性

5. 预览导入内容
   ├─ 显示将导入 N 条记录
   └─ 允许编辑或删除某些记录

6. 确认导入
   ↓
7. 后台处理：
   ├─ 下载音频文件
   ├─ 生成时间戳
   ├─ 提取关键词
   └─ 验证难度

8. 导入完成，显示成功统计
   ├─ 成功: N 条
   ├─ 失败: M 条（显示失败原因）
   └─ 待审核: K 条
```

**支持的导入格式**:
- Excel (.xlsx)
- CSV (.csv)
- 也支持手动添加单条记录

#### 1.3 用户和学习管理

**用户管理**:
```
学生列表
├─ 搜索/筛选学生（按姓名、蓝斯值、班级）
├─ 查看学生学习进度
├─ 修改学生蓝斯值
├─ 删除学生
└─ 批量导入学生（仅支持基本信息）

班级管理
├─ 创建班级
├─ 添加/删除学生
├─ 分配学习任务
└─ 查看班级统计
```

**学习数据统计**:
```
统计仪表板
├─ 学生总数、活跃学生数
├─ 总阅读时长、本周阅读时长
├─ 完成书籍数、完成听力数
├─ 掌握单词总数
├─ 热门书籍排行
├─ 热门听力话题排行
└─ 导出学习报告
```

#### 1.4 系统配置

**配置项**:
```
基础设置
├─ 平台名称、LOGO
├─ 联系信息
└─ 条款和隐私政策

AI 服务配置
├─ DeepSeek API Key
├─ DeepSeek Model（默认 deepseek-chat）
└─ API 调用速率限制

语音服务配置
├─ 选择 TTS 提供商（阿里云/腾讯云/百度）
├─ 相关 API Key 和配置
└─ 音频格式和比特率设置

蓝斯值配置
├─ 自定义难度档次和蓝斯值范围
├─ 蓝斯值查询工具链接
└─ 默认推荐蓝斯值设置

账号和权限
├─ 管理员账户管理
├─ 权限角色设置
├─ 操作日志
└─ 登录历史
```

---

## 技术实现方案

### 1. 整体技术架构

```
┌─────────────────────────────────────────────────────┐
│               用户端 (微信小程序)                     │
│  ┌────────────────────────────────────────────────┐ │
│  │ Vue 3 + TypeScript + Taro/uni-app            │ │
│  │ 书籍、听力、词汇、个人中心、蓝斯值管理          │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
                        ↕ HTTP/HTTPS API
┌─────────────────────────────────────────────────────┐
│           后端 API (NestJS)                         │
│  ┌────────────────────────────────────────────────┐ │
│  │ 路由层 (Controllers)                           │ │
│  │ ├─ /api/books      ├─ /api/chapters          │ │
│  │ ├─ /api/listening  ├─ /api/vocabulary        │ │
│  │ ├─ /api/study-records ├─ /api/auth          │ │
│  │ ├─ /api/lexile-assessment (新增)             │ │
│  │ └─ /api/listening/import (新增)              │ │
│  └────────────────────────────────────────────────┘ │
│                        ↕                             │
│  ┌────────────────────────────────────────────────┐ │
│  │ 业务逻辑层 (Services)                          │ │
│  │ ├─ BookService    ├─ ChapterService          │ │
│  │ ├─ DeepSeekService (AI 核心) (新增)          │ │
│  │ ├─ ListeningService ├─ VocabularyService     │ │
│  │ ├─ LexileService (蓝斯值) (新增)             │ │
│  │ └─ ImportService (批量导入) (新增)           │ │
│  └────────────────────────────────────────────────┘ │
│                        ↕                             │
│  ┌────────────────────────────────────────────────┐ │
│  │ 数据访问层 (Prisma ORM)                       │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
                        ↕
┌─────────────────────────────────────────────────────┐
│           数据存储层                                │
│  ┌──────────────────────┐     ┌──────────────────┐ │
│  │  PostgreSQL          │     │  Redis           │ │
│  │  (主数据库)          │     │  (缓存)          │ │
│  └──────────────────────┘     └──────────────────┘ │
└─────────────────────────────────────────────────────┘
                        ↕
┌─────────────────────────────────────────────────────┐
│           外部 AI 和服务                            │
│  ┌──────────────────┐  ┌──────────────────┐        │
│  │ DeepSeek API     │  │ 阿里云/腾讯云 TTS│       │
│  │ (内容生成/评估)   │  │ (语音合成)      │        │
│  └──────────────────┘  └──────────────────┘        │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│      后台管理系统 (React + TypeScript)             │
│  ├─ 书籍/章节管理    ├─ 听力材料管理 + 快速导入   │
│  ├─ 用户/班级管理    ├─ 数据统计分析              │
│  └─ 系统配置                                      │
└─────────────────────────────────────────────────────┘
```

### 2. 核心技术选型

#### 2.1 前端（学生端）

```
框架: Vue 3 + TypeScript
小程序: Taro 4.x 或 uni-app 3.x
状态管理: Pinia
样式: UnoCSS / Tailwind CSS
HTTP 客户端: axios
音频处理: Web Audio API
```

#### 2.2 后端

```
框架: NestJS 10.x
语言: TypeScript
数据库: PostgreSQL 16 + Prisma ORM
缓存: Redis
认证: JWT + 微信登录
文件存储: 阿里云 OSS（可选）
```

#### 2.3 AI 服务

```
内容生成/评估: DeepSeek API
  - 模型: deepseek-chat
  - 价格: 低廉
  - 可用性: 国内优先

语音合成: 阿里云 TTS（首选）
  - 或腾讯云 TTS（备用）
  - 国内快速、质量好

词义查询: 国内词典 API
  - 如有道词典 API
  - 或自建词库
```

#### 2.4 部署和基础设施

```
容器化: Docker
部署: 阿里云 ECS + RDS
CDN: 阿里云 CDN（音频加速）
监控: Prometheus + Grafana
日志: ELK Stack
```

---

## 数据库设计

### 1. 完整数据模型（Prisma Schema）

```prisma
// 用户表 - 添加蓝斯值字段
model User {
  id        String   @id @default(cuid())
  openid    String   @unique
  nickname  String?
  avatar    String?

  // 蓝斯值管理 (新增)
  lexileScore     Float?    // 用户当前蓝斯值
  lexileLevel     String?   // 难度档次 (初级/KET/PET/自定义)
  lexileUpdatedAt DateTime?

  role      String   @default("student")

  books         Book[]
  chapters      Chapter[]
  vocabulary    Vocabulary[]
  studyRecords  StudyRecord[]
  bookmarks     Bookmark[]
  listeningHistory ListeningHistory[]

  // AI 判定历史 (新增)
  lexileAssessments LexileAssessment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([openid, lexileScore])
}

// 蓝斯值评估历史 (新增表)
model LexileAssessment {
  id        String @id @default(cuid())
  userId    String
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // 评估方式
  method    String // "manual" / "ai" / "uploaded_words"

  // 评估结果
  minLexile Float
  maxLexile Float
  recommendedLevel String // 初级/KET/PET/自定义

  // 如果是 AI 评估，记录输入
  inputContent String? @db.Text // 上传的单词或文本

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

// 书籍表 - 更新蓝斯值字段
model Book {
  id              String   @id @default(cuid())
  title           String
  author          String?
  description     String?  @db.Text
  coverUrl        String?

  // 原始蓝斯值
  originalLexile  Float?

  chapters        Chapter[]
  studyRecords    StudyRecord[]

  status          String   @default("draft")
  publishedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([originalLexile])
}

// 章节表 - 添加多版本内容
model Chapter {
  id              String   @id @default(cuid())
  bookId          String
  book            Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)

  chapterNumber   Int
  title           String

  // 多个难度版本的内容
  originalContent         String @db.Text // 原始英文

  // 根据用户蓝斯值自动选择的 4 个版本
  easyAdaptedContent      String? @db.Text  // 初级版 (600-800L)
  ketAdaptedContent       String? @db.Text  // KET版 (800-1000L)
  petAdaptedContent       String? @db.Text  // PET版 (1000-1200L)
  customAdaptedContent    String? @db.Text  // 自定义版本（动态生成）

  // 对应的蓝斯值
  originalLexile      Float?
  easyLexile          Float? @default(700)
  ketLexile           Float? @default(900)
  petLexile           Float? @default(1100)
  customLexile        Float? // 自定义蓝斯值

  // 音频相关
  audioUrl        String?
  audioGenerated  Boolean @default(false)

  studyRecords    StudyRecord[]
  bookmarks       Bookmark[]
  extractedTopics ExtractedTopic[]

  status          String  @default("draft")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([bookId, chapterNumber])
  @@index([bookId])
}

// 话题表 - 从书籍自动提取
model ExtractedTopic {
  id        String @id @default(cuid())
  chapterId String
  chapter   Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  topicName    String
  description  String? @db.Text
  category     String  // 日常生活/科技/历史等 (6大分类)
  keywords     String  @db.Text  // JSON 数组
  relatedListenings String? @db.Text

  createdAt DateTime @default(now())

  @@index([chapterId, category])
}

// 听力内容表 - 支持批量导入
model ListeningContent {
  id          String @id @default(cuid())

  title       String
  description String? @db.Text

  category    String  // 6 大话题分类
  difficulty  String  // 初级/KET/PET/Advanced/Expert
  duration    Int     // 秒数

  contentType String  // dialogue/narrative/discussion/interview

  // 音频和文本
  audioUrl    String
  transcript  String @db.Text

  // 字幕和翻译
  subtitles   String @db.Text  // JSON: [{ time: "00:05", text: "..." }]
  translation String @db.Text

  // 批量导入元数据 (新增)
  importedFrom String? // 导入来源标识
  importedAt   DateTime? // 导入时间
  importedBy   String? // 导入者 ID

  listeningHistory ListeningHistory[]

  status      String @default("draft")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category, difficulty, importedAt])
}

// 听力历史 - 用户学习记录
model ListeningHistory {
  id        String @id @default(cuid())
  userId    String
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  listeningId String
  listening   ListeningContent @relation(fields: [listeningId], references: [id], onDelete: Cascade)

  completedAt DateTime?
  duration    Int?
  score       Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, listeningId])
  @@index([userId])
}

// 其他表保持不变：
// - Vocabulary (生词本)
// - StudyRecord (学习进度)
// - Bookmark (书签)
```

---

## 开发路线图

### Phase 1: 基础架构（4 周）

#### 周 1-2: 后端基础设施
- [ ] NestJS 项目初始化
- [ ] PostgreSQL 数据库设计和创建
- [ ] Prisma 迁移脚本
- [ ] 用户认证模块（微信登录）
- [ ] **蓝斯值管理 API** (新增)
- [ ] **DeepSeek 集成** (新增)

#### 周 2-3: 前端框架
- [ ] Vue 3 + Taro 项目初始化
- [ ] 页面结构搭建
- [ ] 底部导航栏
- [ ] **蓝斯值选择页面** (新增)
- [ ] 基础组件库

#### 周 4: 前后端联调
- [ ] 蓝斯值 API 联调
- [ ] 认证流程测试
- [ ] 性能基准测试
- [ ] 部署到开发环境

**交付物**:
- ✅ 可运行的后端 API
- ✅ 可运行的前端框架
- ✅ 蓝斯值获取和管理功能

### Phase 2: 阅读核心功能（6 周）

#### 周 1-2: 书籍和章节管理
- [ ] 书籍 CRUD API
- [ ] 章节 CRUD API（包含多版本）
- [ ] 书籍列表页面
- [ ] 章节阅读基础框架

#### 周 2-3: AI 难度适配
- [ ] 蓝斯值评估接口（DeepSeek）
- [ ] 内容转写接口（DeepSeek）
- [ ] 多版本生成逻辑
- [ ] 人工审核流程

#### 周 3-4: 词义查询和生词本
- [ ] 词义查询 API
- [ ] 点击查词交互
- [ ] 生词本 CRUD
- [ ] 生词本页面

#### 周 4-5: 学习进度和阿里云 TTS
- [ ] 进度保存 API
- [ ] **TTS 语音合成集成** (新增)
- [ ] 语速调节实现
- [ ] 个人中心基础页面

#### 周 5-6: 整合和优化
- [ ] 端到端测试
- [ ] 性能优化
- [ ] UI/UX 优化

**交付物**:
- ✅ 完整的阅读流程
- ✅ AI 难度适配功能
- ✅ 词义查询功能
- ✅ 语音朗读功能

### Phase 3: 听力训练模块（4 周）

#### 周 1: 听力内容管理
- [ ] 听力内容数据模型
- [ ] 听力 CRUD API
- [ ] **批量导入功能** (核心新增)
- [ ] 话题和难度分类系统

#### 周 1-2: **批量导入功能** (核心)
- [ ] Excel/CSV 解析
- [ ] 数据验证规则
- [ ] 音频 URL 验证
- [ ] 导入进度和错误处理
- [ ] 导入后的自动处理（时间戳、关键词）

#### 周 2-3: 听力训练页面
- [ ] 音频播放器
- [ ] 语速调节
- [ ] 字幕同步显示
- [ ] 专注模式

#### 周 3-4: AI 话题生成（可选）
- [ ] 话题提取 AI 接口
- [ ] 相关听力生成
- [ ] 自动分类逻辑

**交付物**:
- ✅ 完整的听力训练系统
- ✅ 快速导入听力材料
- ✅ 多维度的训练模式

### Phase 4: 后台管理系统（3 周）

#### 周 1: 后台框架搭建
- [ ] React 后台项目初始化
- [ ] 路由和权限管理
- [ ] 基础表格和表单组件

#### 周 1-2: 核心管理功能
- [ ] 书籍管理（CRUD + 审核）
- [ ] 章节编辑和预览
- [ ] **听力批量导入管理** (新增)
- [ ] 用户和班级管理

#### 周 2-3: 数据统计和优化
- [ ] 学习数据统计
- [ ] 报告生成和导出
- [ ] 权限管理
- [ ] 系统配置

**交付物**:
- ✅ 完整的后台管理系统
- ✅ 管理员工作流程

### Phase 5: 优化和部署（2 周）

#### 周 1: 优化和测试
- [ ] 性能优化（缓存、CDN）
- [ ] 安全审计
- [ ] 功能测试和 bug 修复
- [ ] 用户反馈迭代

#### 周 2: 部署和上线
- [ ] Docker 容器化
- [ ] 阿里云部署
- [ ] 小程序发布申请
- [ ] 监控和告警配置

**交付物**:
- ✅ 生产就绪的平台
- ✅ 完整的文档和用户手册

---

## 验收标准

### 功能验收

#### 蓝斯值和难度系统
- [ ] 用户能正常选择难度档次（初级/KET/PET）
- [ ] 用户能输入自定义蓝斯值
- [ ] 用户能上传单词让 AI 判定蓝斯值
- [ ] 系统根据蓝斯值推荐合适的书籍版本
- [ ] 用户能随时修改蓝斯值，系统自动推荐

#### 阅读模块
- [ ] 用户能浏览书籍列表
- [ ] 原文和适配版正确显示和切换
- [ ] 点击单词能查询释义
- [ ] 生词本正确保存和导出
- [ ] 进度正确记录和恢复
- [ ] 音频朗读支持语速调节
- [ ] 字幕同步播放

#### 听力模块
- [ ] 听力内容按话题分类展示
- [ ] 难度分级正确
- [ ] **批量导入听力材料成功** (新增)
- [ ] 导入后的听力内容可正常使用
- [ ] 音频播放和语速调节正常
- [ ] 字幕同步显示
- [ ] 专注模式逐句训练

#### 后台管理
- [ ] 书籍和章节可正确管理
- [ ] **听力材料可快速批量导入** (新增)
- [ ] AI 适配能正确触发和审核
- [ ] 用户和班级可管理
- [ ] 学习数据统计准确

### 性能验收

- [ ] 页面加载时间 < 2 秒（4G 环境）
- [ ] 书籍列表滚动流畅（60fps）
- [ ] AI 适配响应时间 < 30 秒
- [ ] TTS 语音生成 < 10 秒
- [ ] 小程序包体积 < 2MB（主包）

### 国内适配验收

- [ ] DeepSeek API 可正常调用
- [ ] 阿里云 TTS 语音合成可用
- [ ] 所有外部 API 在国内可访问
- [ ] 无需科学上网即可正常使用

### 用户体验验收

- [ ] 蓝斯值选择流程简单直观
- [ ] 界面设计符合儿童友好原则
- [ ] 操作流程直观易懂
- [ ] 错误提示清晰有效
- [ ] 无障碍支持（alt 文本等）

---

## 关键创新点总结

### 1. **4 档难度 + 自定义蓝斯值**
- 初级、KET、PET 三个标准档次
- 自定义蓝斯值满足精细化需求
- AI 可自动判定用户精准蓝斯值

### 2. **听力材料快速导入**
- Excel/CSV 批量导入
- 自动验证和处理
- 一次导入数百条听力内容

### 3. **国内友好的技术栈**
- DeepSeek AI（国内优先）
- 阿里云 TTS（快速稳定）
- 所有能力确保国内可用

### 4. **Vue 前端框架**
- Taro 编译到小程序
- 更适合微信生态
- 性能优化更容易

---

## 附录：关键网址和资源

### AI 和工具网址

```
蓝斯值查询工具:
- https://www.lexile.com/find-a-book/
- 用户可自行查询书籍的蓝斯值

DeepSeek API:
- https://platform.deepseek.com/api-docs
- 文档完整，支持国内访问

阿里云 TTS:
- https://www.aliyun.com/product/ai/speech
- 产品文档和价格信息
```

---

**文档完成时间**: 2025-10-25
**版本**: 2.0
**状态**: 完整可执行设计方案
