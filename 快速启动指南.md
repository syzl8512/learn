# 项目快速启动指南

## 前置条件

1. **安装 Docker Desktop** (macOS/Windows) 或 Docker Engine (Linux)
2. **Node.js >= 18**
3. **pnpm** (前端包管理器)

## 启动步骤

### 1. 启动 Docker 容器（必须）

首先确保 Docker Desktop 正在运行，然后执行：

```bash
# 在项目根目录执行
cd /Users/zhangliang/Documents/GitHub/learn

# 启动 PostgreSQL 和 Redis 容器
docker compose up -d

# 查看容器状态
docker compose ps

# 应该看到两个容器正在运行：
# - reading-app-postgres (PostgreSQL)
# - reading-app-redis (Redis)
```

### 2. 配置后端环境变量

```bash
cd backend

# 如果还没有 .env 文件，创建一个
去到 backend 目录，检查是否有 .env 文件
如果没有，根据 DATABASE_URL 格式创建：
DATABASE_URL="postgresql://postgres:postgres@localhost:5434/reading_app"
REDIS_HOST=localhost
REDIS_PORT=6380
```

### 3. 初始化数据库（首次启动）

```bash
cd backend

# 安装依赖
npm install

# 生成 Prisma Client
npm run prisma:generate

# 运行数据库迁移
npm run prisma:migrate

# 可选：插入测试数据
npm run prisma:seed
```

### 4. 启动后端服务

```bash
cd backend

# 开发模式启动
npm run start:dev

# 或者简单模式启动（不包含所有功能）
npm run start:simple
```

后端服务将在 `http://localhost:3000` 启动

### 5. 启动前端（Admin 管理后台）

```bash
cd admin

# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev
```

前端服务将在 `http://localhost:5173` (或 Vite 默认端口) 启动

---

## 完整的启动流程（一键命令）

如果您已经配置好环境，可以按顺序执行：

```bash
# 1. 启动 Docker（必须）
docker compose up -d

# 2. 等待几秒让数据库就绪，然后启动后端
cd backend && npm run start:dev

# 3. 在新终端启动前端
cd admin && pnpm dev
```

---

## 停止服务

```bash
# 停止后端和前端：按 Ctrl+C

# 停止 Docker 容器
docker compose down

# 停止并删除数据卷（会删除所有数据，谨慎使用！）
docker compose down -v
```

---

## 访问地址

启动成功后：

- **后端 API**: http://localhost:3000
- **Swagger 文档**: http://localhost:3000/api-docs
- **前端管理后台**: http://localhost:5173 (或 Vite 显示的端口)

---

## 常见问题

### 1. Docker 未运行

**错误**: `Cannot connect to the Docker daemon`

**解决**: 
- macOS/Windows: 打开 Docker Desktop 应用
- Linux: `sudo systemctl start docker`

### 2. 端口被占用

**错误**: `Port 5434 is already allocated` (PostgreSQL)

**解决**:
```bash
# 检查占用端口的进程
lsof -i :5434

# 停止占用端口的容器或进程
docker compose down
# 或
kill -9 <PID>
```

### 3. 数据库连接失败

**错误**: `Can't reach database server`

**解决**:
```bash
# 确保 Docker 容器正在运行
docker compose ps

# 检查数据库日志
docker logs reading-app-postgres

# 测试数据库连接
docker exec -it reading-app-postgres pg_isready -U postgres
```

### 4. Redis 连接失败

**解决**:
```bash
# 检查 Redis 容器
docker logs reading-app-redis

# 测试 Redis 连接
docker exec -it reading-app-redis redis-cli ping
# 应该返回: PONG
```

---

## 仅启动前端（不启动后端）

如果您只是想查看前端界面，可以只启动前端：

```bash
cd admin
pnpm install
pnpm dev
```

但注意：
- 无法调用后端 API（登录等功能不可用）
- 只能查看 UI 界面

---

## 项目结构说明

- **backend/**: NestJS 后端服务（需要 PostgreSQL + Redis）
- **admin/**: React 管理后台前端（可以独立运行，但需要后端 API）
- **frontend/**: Vue 用户端前端（可以独立运行，但需要后端 API）

