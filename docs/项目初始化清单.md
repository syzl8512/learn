# 项目初始化清单

**文档目的**: 为 Claude Code 和开发团队提供项目启动前的检查清单

**创建日期**: 2025-10-25
**版本**: 1.0

---

## 📋 项目文档检查

### 已完成的文档 ✅

- [x] **CLAUDE.md** - 项目开发指南（890+ 行）
  - 技术栈、项目结构、快速启动、模块说明、数据库设计

- [x] **discuss/微信小程序技术方案讨论.md** - 技术方案讨论稿
  - Taro 方案分析、前后端改动清单、关键风险、5 个确认问题

- [x] **REVIEW_SUMMARY.md** - 审阅总结
  - 已完成项、关键改动、后续工作、建议事项

- [x] **项目需求文档.md** - 功能需求（已有）
  - 核心功能、技术架构、业务流程、验收标准

- [x] **项目开发计划.md** - 开发规划（已有）
  - 子代理分工、并行协作、WBS 任务拆分

- [x] **todo.md** - 任务清单（已有，待更新）

### 待创建的文档 ⏳

- [ ] **docs/API-规范.md** - 完整 OpenAPI 定义
  - 所有后端端点、请求/响应格式、错误码
  - **优先级**: P0 Phase 1
  - **工作量**: 1 天

- [ ] **docs/数据库设计.md** - Prisma Schema 详细说明
  - 表结构、关系、索引、迁移流程
  - **优先级**: P0 Phase 1
  - **工作量**: 1 天

- [ ] **docs/部署指南.md** - 生产部署流程
  - 阿里云、Docker、HTTPS、监控配置
  - **优先级**: P2 Phase 4
  - **工作量**: 2 天

- [ ] **docs/开发环境配置.md** - 本地开发环境搭建
  - Node.js、PostgreSQL、Docker、微信开发者工具
  - **优先级**: P1 Phase 1
  - **工作量**: 半天

---

## 🎯 用户确认事项

### 高优先级（需要立即确认）

**Q1: 前端框架选择** ⏳
- [ ] 同意使用 Taro 4.x 替代 React Web？
- [ ] 接受一套代码编译到小程序 + H5？
- **影响**: 前端项目初始化方向

**Q2: 微信小程序账号** ⏳
- [ ] 是否已有微信公众平台账号？
- [ ] AppID 何时可用？
- **影响**: 开发进度和账号配置

**Q3: HTTPS 部署时机** ⏳
- [ ] Phase 1 就需要 HTTPS 吗？
- [ ] 还是延迟到 Phase 4？
- **影响**: 网络配置和上线时间

### 中等优先级（需要确认）

**Q4: H5 版本需求** ⏳
- [ ] 是否需要 H5 网页版（PC 管理等）？
- [ ] 优先级如何？
- **影响**: 前端工作量估算

**Q5: 原 atomic 代码** ⏳
- [ ] 为何删除 atomic 目录？
- [ ] 后续是否需要复用相关能力？
- **影响**: 代码复用策略

---

## 🛠️ 技术环境检查

### 本地开发环境前置条件

**系统环境** ⏳
- [ ] Node.js 18+ (`node --version`)
- [ ] npm 9+ 或 pnpm 8+ (`npm --version`)
- [ ] Python 3.8+ (`python3 --version`) - 用于 pdf_to_markdown.py
- [ ] Docker & Docker Compose (`docker --version`)
- [ ] Git (`git --version`)

**开发工具** ⏳
- [ ] VS Code（推荐）
  - 扩展: ES7+, Prettier, ESLint
  - Taro 官方扩展（前端开发）

- [ ] 微信开发者工具（小程序开发）
  - 下载: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
  - 用处: 编译/调试小程序

- [ ] Postman 或 REST Client（API 测试）

**账号与密钥** ⏳
- [ ] 微信公众平台账号
- [ ] 小程序 AppID 和 AppSecret
- [ ] PostgreSQL 本地连接配置
- [ ] 其他 API Key（MinerU 等，Phase 2）

---

## 📂 项目初始化步骤

### Step 1: 克隆/初始化项目（如还未做）⏳

```bash
# 进入项目目录
cd /Users/zhangliang/Desktop/英语分级阅读

# 初始化 Git（如需要）
git init
git remote add origin <your-repo-url>
```

### Step 2: 创建后端项目 ⏳

```bash
# 创建后端目录
mkdir -p backend

# 初始化 NestJS 项目（方式 A：使用脚手架）
cd backend
npm install -g @nestjs/cli
nest new . --package-manager npm

# 或方式 B：手动创建
# (参考 CLAUDE.md 的"后端快速启动"部分)

# 初始化数据库
docker-compose up -d          # 启动 PostgreSQL
npm run prisma:migrate:dev    # 首次迁移
```

### Step 3: 创建前端项目 ⏳

```bash
# 创建前端目录
mkdir -p frontend

# 使用 Taro 脚手架初始化（如 Q1 同意）
cd frontend
npm install -g @tarojs/cli
npx @tarojs/cli@latest init . --typescript --react

# 或手动配置（参考 CLAUDE.md）
```

### Step 4: 创建启动脚本 ⏳

```bash
# 在 scripts/ 目录下创建以下脚本
touch scripts/dev.sh
touch scripts/db-setup.sh
touch scripts/build.sh
touch scripts/clean.sh

# 使脚本可执行
chmod +x scripts/*.sh
```

**脚本内容示例** (参考 CLAUDE.md "快速启动" 部分):

```bash
# scripts/dev.sh
#!/bin/bash
echo "启动数据库..."
cd backend && docker-compose up -d
echo "启动后端..."
npm run dev &
echo "启动前端..."
cd ../frontend && npm run dev:weapp
```

### Step 5: 配置环境变量 ⏳

**后端** (`backend/.env`):
```env
PORT=3000
NODE_ENV=development
DATABASE_URL=postgresql://user:password@localhost:5432/reading_db
JWT_SECRET=dev_secret_change_in_prod
JWT_EXPIRES_IN=7d
WECHAT_APP_ID=<from-wechat-mp>
WECHAT_APP_SECRET=<from-wechat-mp>
UPLOAD_DIR=./uploads
```

**前端** (`frontend/.env.development`):
```env
TARO_APP_API_BASE=http://localhost:3000/api
TARO_APP_LOG_LEVEL=info
```

### Step 6: 安装依赖 ⏳

```bash
# 后端
cd backend && npm install

# 前端
cd ../frontend && npm install
```

### Step 7: 测试启动 ⏳

```bash
# 启动后端
cd backend && npm run dev
# 期望: 看到 "🚀 Backend running at http://localhost:3000"

# 新标签页启动前端
cd frontend && npm run dev:weapp
# 期望: Taro 编译成功，dist/weapp 目录已生成

# 用微信开发者工具打开 dist/weapp
# 期望: 小程序预览正常
```

---

## 📊 工作量估算与时间表

### Phase 1: 基础功能（4 周）

| 任务 | 工作量 | 责任方 | 状态 |
|------|--------|--------|------|
| 后端框架 + 数据库初始化 | 1 周 | [BE] | ⏳ |
| 微信登录集成（后端 + 前端） | 3 天 | [BE] + [FE] | ⏳ |
| 书籍/章节 CRUD API | 3 天 | [BE] | ⏳ |
| Taro 项目初始化 + 基础页面 | 1 周 | [FE] | ⏳ |
| PDF + MinerU 集成 | 1 周 | [管道] | ⏳ |

**阶段完成标志**:
- ✅ 后端 API 文档完整（OpenAPI）
- ✅ 前端可成功登录并展示书籍列表
- ✅ PDF 上传 → Markdown 转换流程打通
- ✅ 本地一键启动脚本可用

---

## 🔐 安全检查清单

在提交代码前确认:

- [ ] **密钥管理**
  - 不上传真实密钥到 Git
  - 使用 `.env.local` + `.gitignore`
  - 生产密钥通过环境变量传入

- [ ] **代码质量**
  - 文件大小 ≤ 300 行（动态语言）
  - 无循环依赖、代码重复
  - 无全局状态滥用
  - 通过 ESLint 和 TypeScript 检查

- [ ] **数据库**
  - Prisma 迁移脚本版本控制
  - 敏感数据加密存储
  - 备份策略

- [ ] **API**
  - 已认证端点使用 JwtAuthGuard
  - 参数校验（DTO + class-validator）
  - 错误响应统一格式

---

## 📖 推荐阅读顺序

对于新加入的开发者:

1. **第一天** - 理解全景
   - 阅读: 项目需求文档.md
   - 阅读: CLAUDE.md 的"项目概述"和"技术架构"

2. **第二天** - 了解架构
   - 阅读: CLAUDE.md 的"项目结构"和"8 大模块说明"
   - 阅读: CLAUDE.md 的"数据库设计"

3. **第三天** - 准备开发环境
   - 按照本文件的"项目初始化步骤"操作
   - 本地测试启动脚本

4. **第四天** - 开始编码
   - 参考 CLAUDE.md 的"快速启动"部分
   - 选择你的责任模块开始开发

---

## 🚨 常见问题 & 排查

**Q: Docker Compose 启动失败？**
```bash
# 检查 Docker 是否运行
docker ps

# 查看日志
docker-compose logs postgres

# 强制重建
docker-compose up -d --force-recreate
```

**Q: npm 依赖冲突？**
```bash
# 清空并重新安装
rm -rf node_modules package-lock.json
npm install
```

**Q: Taro 编译报错？**
```bash
# 检查 Node 版本（需要 18+）
node --version

# 清空缓存
rm -rf dist
npm run dev:weapp
```

**Q: Prisma 迁移失败？**
```bash
# 重置数据库（仅开发环境）
npm run prisma:migrate:resolve --name <migration_name> --rolled-back

# 重新迁移
npm run prisma:migrate:dev
```

---

## ✅ 最终检查

启动前，确认以下项目都打上 ✅:

**文档** ✅
- [ ] CLAUDE.md 已审阅
- [ ] discuss/ 方案已讨论
- [ ] todo.md 已更新（分配给各子代理）

**代码** ✅
- [ ] 后端项目已初始化
- [ ] 前端 Taro 项目已初始化
- [ ] 环境变量已配置
- [ ] 依赖已安装

**测试** ✅
- [ ] 数据库可连接
- [ ] 后端可启动（http://localhost:3000）
- [ ] 前端可编译（dist/weapp 目录存在）
- [ ] Swagger UI 可访问（http://localhost:3000/api）

**协作** ✅
- [ ] 分支策略已确认（main + develop + feature/）
- [ ] 提交信息规范已理解
- [ ] 子代理标签已分配（[BE] [FE] [AI] 等）
- [ ] 日志和脚本位置已确认（logs/ + scripts/）

---

**这份检查清单完成后，团队就可以启动 Phase 1 开发了！** 🚀

---

**文档维护者**: Claude Code
**最后更新**: 2025-10-25
**版本**: 1.0

