# 数据模型改进建议

## 问题描述
当前 `Vocabulary` 数据模型缺少记录复习正确/错误次数的字段，导致无法准确计算词汇学习的准确率。

## 当前模型
```prisma
model Vocabulary {
  // ... 其他字段 ...
  reviewCount       Int       @default(0) // 复习次数
  // ... 其他字段 ...
}
```

## 建议改进

### 方案1：添加正确/错误计数字段（推荐）
```prisma
model Vocabulary {
  // ... 其他字段 ...
  reviewCount       Int       @default(0) // 总复习次数
  correctCount      Int       @default(0) // 正确复习次数
  incorrectCount    Int       @default(0) // 错误复习次数
  // ... 其他字段 ...
}
```

**优点**：
- 简单直接，易于实现
- 查询性能好
- 可以直接计算准确率：`correctCount / (correctCount + incorrectCount) * 100`

**缺点**：
- 无法查看历史复习记录
- 无法分析复习趋势

### 方案2：创建独立的复习记录表（更完整）
```prisma
model VocabularyReview {
  id            String   @id @default(cuid())
  vocabularyId  String
  vocabulary    Vocabulary @relation(fields: [vocabularyId], references: [id], onDelete: Cascade)
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  isCorrect     Boolean  // 是否正确
  responseTime  Int?     // 响应时间（毫秒）
  reviewMethod  String   // 复习方式：flashcard/spelling/translation等

  createdAt     DateTime @default(now())

  @@index([vocabularyId])
  @@index([userId])
  @@index([createdAt])
  @@map("vocabulary_reviews")
}
```

**优点**：
- 完整的历史记录
- 可以分析学习趋势
- 支持更复杂的学习分析

**缺点**：
- 数据表增加
- 查询略微复杂
- 需要额外的数据存储空间

## 推荐实施步骤

### 短期方案（快速修复）
采用**方案1**，添加 `correctCount` 和 `incorrectCount` 字段：

1. 修改 `backend/prisma/schema.prisma`
2. 创建数据库迁移：`npm run prisma:migrate --name add_vocabulary_review_counts`
3. 更新 `vocabulary.service.ts` 中的复习记录方法
4. 更新 `analytics.service.ts` 中的准确率计算逻辑

### 长期方案（完整功能）
在 Phase 2 或 Phase 3 实施**方案2**，创建独立的复习记录表。

## 受影响的文件
- `backend/prisma/schema.prisma` - 数据模型定义
- `backend/src/modules/vocabulary/vocabulary.service.ts` - 词汇服务
- `backend/src/modules/analytics/analytics.service.ts` - 分析服务
- `backend/src/modules/vocabulary/dto/` - DTO 定义

## 当前状态
- ✅ 已修复词汇统计逻辑错误（mastered 字段查询）
- ⏳ 准确率计算暂时返回 0，等待数据模型改进
- ⏳ 在代码中添加了 TODO 注释，标记需要改进的地方

## 相关 Issue
- 错误1：词汇统计 mastered 字段缺失条件 - ✅ 已修复
- 错误2：准确率计算重复使用 reviewCount - ✅ 已临时修复（返回0）
