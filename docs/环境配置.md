# ç¯å¢ƒé…ç½®æŒ‡å—

**ç‰ˆæœ¬**: 1.0
**æ—¥æœŸ**: 2025-10-25
**ç”¨é€”**: æœ¬åœ°å¼€å‘å’Œç”Ÿäº§éƒ¨ç½²ç¯å¢ƒé…ç½®

---

## ğŸ“‹ ç›®å½•

1. [æœ¬åœ°å¼€å‘ç¯å¢ƒ](#æœ¬åœ°å¼€å‘ç¯å¢ƒ)
2. [DeepSeek API é…ç½®](#deepseek-api-é…ç½®)
3. [é˜¿é‡Œäº‘ TTS é…ç½®](#é˜¿é‡Œäº‘-tts-é…ç½®)
4. [å¾®ä¿¡å°ç¨‹åºé…ç½®](#å¾®ä¿¡å°ç¨‹åºé…ç½®)
5. [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
6. [Redis é…ç½®](#redis-é…ç½®)
7. [ç”Ÿäº§ç¯å¢ƒé…ç½®](#ç”Ÿäº§ç¯å¢ƒé…ç½®)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## æœ¬åœ°å¼€å‘ç¯å¢ƒ

### ç³»ç»Ÿè¦æ±‚

**æœ€ä½é…ç½®**:
- macOS 12+ / Windows 11+ / Ubuntu 20.04+
- 8GB RAM (å»ºè®®16GB)
- 50GB å¯ç”¨ç£ç›˜ç©ºé—´
- ç½‘ç»œè¿æ¥ (å›½å†…ç”¨æˆ·éœ€ç¡®ä¿èƒ½è®¿é—® DeepSeek/Aliyun)

### å¿…éœ€è½¯ä»¶

```bash
# Node.js 18+ (ä½¿ç”¨ nvm ç®¡ç†ç‰ˆæœ¬)
nvm install 18.17.0
nvm use 18.17.0
node --version  # v18.17.0

# Python 3.8+ (ç”¨äº PDF å¤„ç†)
python3 --version  # Python 3.8+

# Docker & Docker Compose
docker --version    # Docker 24.0+
docker-compose --version  # Docker Compose v2.20+

# Git
git --version  # git 2.40+
```

### å¿«é€Ÿå®‰è£…è„šæœ¬ (macOS)

```bash
# ä½¿ç”¨ Homebrew
brew install node@18 python@3.10 docker

# ä½¿ç”¨ nvm (æ¨è)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18.17.0
```

### IDE & å¼€å‘å·¥å…·

**æ¨è VS Code æ‰©å±•**:
- ES7+ React/Redux/React-Native snippets
- Prettier Code Formatter
- ESLint
- Volar (Vue 3 å®˜æ–¹)
- Thunder Client (APIæµ‹è¯•)

**å…¶ä»–å·¥å…·**:
- å¾®ä¿¡å¼€å‘è€…å·¥å…· (å°ç¨‹åºè°ƒè¯•)
- Postman / Insomnia (APIæµ‹è¯•)
- DBeaver (æ•°æ®åº“ç®¡ç†)

### é¡¹ç›®ä¾èµ–å®‰è£…

```bash
cd /Users/zhangliang/Desktop/è‹±è¯­åˆ†çº§é˜…è¯»

# åç«¯ä¾èµ–
cd backend
npm install

# å‰ç«¯ä¾èµ–
cd ../frontend
npm install
```

---

## DeepSeek API é…ç½®

### 1. ç”³è¯· API Key

**å®˜ç½‘**: https://platform.deepseek.com/

**æ­¥éª¤**:
1. è®¿é—®å®˜ç½‘ï¼Œç‚¹å‡»ã€Œå¼€å‘è€…å¹³å°ã€
2. ä½¿ç”¨é‚®ç®±æˆ–å¾®ä¿¡æ³¨å†Œè´¦å·
3. è¿›å…¥ã€ŒAPI Keyã€ç®¡ç†é¡µé¢
4. ç‚¹å‡»ã€Œåˆ›å»ºæ–°API Keyã€
5. å¤åˆ¶ API Key (ä»…æ˜¾ç¤ºä¸€æ¬¡ï¼Œå¦¥å–„ä¿ç®¡)

**ç¤ºä¾‹ API Key**:
```
sk-...æ‚¨çš„api key...
```

### 2. åç«¯é…ç½®

**åˆ›å»ºæ–‡ä»¶**: `backend/.env.local`

```env
# DeepSeek API é…ç½®
DEEPSEEK_API_KEY=sk_your_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_MAX_TOKENS=2000
DEEPSEEK_TIMEOUT=30000

# å†…å®¹é€‚é…é…ç½®
AI_ADAPTATION_ENABLED=true
AI_ADAPTATION_TIMEOUT=60000  # 60ç§’è¶…æ—¶
```

### 3. å‰ç«¯é…ç½® (å¯é€‰ï¼Œæ•æ„Ÿæ“ä½œèµ°åç«¯)

**åˆ›å»ºæ–‡ä»¶**: `frontend/.env.development`

```env
TARO_APP_DEEPSEEK_ENABLED=false
# å‰ç«¯ä¸€èˆ¬ä¸ç›´æ¥è°ƒç”¨DeepSeekï¼Œé€šè¿‡åç«¯ä»£ç†
```

### 4. API ä½¿ç”¨ç¤ºä¾‹

**åç«¯ NestJS é›†æˆ**:

```typescript
// src/services/deepseek.service.ts
import { Injectable } from '@nestjs/common';
import axios from 'axios';

@Injectable()
export class DeepSeekService {
  private apiKey = process.env.DEEPSEEK_API_KEY;
  private apiUrl = process.env.DEEPSEEK_API_URL;
  private model = process.env.DEEPSEEK_MODEL;

  async adaptContent(
    originalText: string,
    targetLexile: number,
  ): Promise<string> {
    const messages = [
      {
        role: 'system',
        content: `ä½ æ˜¯ä¸€ä¸ªè‹±è¯­å†…å®¹éš¾åº¦é€‚é…ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†è‹±æ–‡æ–‡æœ¬é€‚é…åˆ°ç‰¹å®šè“æ–¯å€¼éš¾åº¦ã€‚

ç›®æ ‡è“æ–¯å€¼: ${targetLexile}L
è¦æ±‚:
1. ä¿æŒåŸæ„ï¼Œç®€åŒ–å¤æ‚è¯æ±‡å’Œå¥å¼
2. å¥å­é•¿åº¦ä¿æŒåˆç†ï¼ˆ10-15è¯ï¼‰
3. é¿å…ä½¿ç”¨ç”Ÿåƒ»è¯æ±‡
4. ä¿æŒæ•…äº‹é€»è¾‘è¿è´¯`,
      },
      {
        role: 'user',
        content: `è¯·å°†ä»¥ä¸‹æ–‡æœ¬é€‚é…åˆ°${targetLexile}Léš¾åº¦:\n\n${originalText}`,
      },
    ];

    try {
      const response = await axios.post(
        `${this.apiUrl}/chat/completions`,
        {
          model: this.model,
          messages,
          max_tokens: parseInt(process.env.DEEPSEEK_MAX_TOKENS),
          temperature: 0.3,
        },
        {
          headers: {
            Authorization: `Bearer ${this.apiKey}`,
            'Content-Type': 'application/json',
          },
          timeout: parseInt(process.env.DEEPSEEK_TIMEOUT),
        },
      );

      return response.data.choices[0].message.content;
    } catch (error) {
      console.error('DeepSeek API error:', error);
      throw new Error('å†…å®¹é€‚é…å¤±è´¥');
    }
  }

  async assessLexileFromWords(words: string[]): Promise<number> {
    const messages = [
      {
        role: 'system',
        content: `ä½ æ˜¯ä¸€ä¸ªè‹±è¯­éš¾åº¦è¯„ä¼°ä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·æŒæ¡çš„å•è¯ï¼Œè¯„ä¼°å…¶è‹±è¯­æ°´å¹³å¯¹åº”çš„è“æ–¯å€¼ã€‚

è“æ–¯å€¼èŒƒå›´:
- åˆçº§ (400-600L): 6-8å²
- KET (600-900L): 8-10å²
- PET (900-1200L): 10-12å²

è¿”å›æ ¼å¼: ä»…è¿”å›æ•°å­—ï¼Œå¦‚ 750`,
      },
      {
        role: 'user',
        content: `ç”¨æˆ·æŒæ¡çš„å•è¯: ${words.join(', ')}\nè¯·è¯„ä¼°å…¶è“æ–¯å€¼`,
      },
    ];

    const response = await axios.post(
      `${this.apiUrl}/chat/completions`,
      {
        model: this.model,
        messages,
        max_tokens: 10,
        temperature: 0.1,
      },
      {
        headers: {
          Authorization: `Bearer ${this.apiKey}`,
        },
      },
    );

    const lexile = parseInt(response.data.choices[0].message.content.trim());
    return isNaN(lexile) ? 750 : lexile;
  }
}
```

### 5. è´¹ç”¨ä¼°ç®—

**DeepSeek å®šä»·** (å›½å†…ç”¨æˆ·å‹å¥½):

```
è¾“å…¥ token: Â¥0.14/ç™¾ä¸‡
è¾“å‡º token: Â¥0.28/ç™¾ä¸‡

ç¤ºä¾‹:
- å†…å®¹é€‚é…ä¸€æœ¬ä¹¦ (10ä¸‡å­—): ~Â¥2-3
- AIè¯„ä¼°è“æ–¯å€¼ä¸€æ¬¡: ~Â¥0.01
- æœˆå‡æˆæœ¬ (1000æœ¬ä¹¦): ~Â¥200-300
```

**ä¸å…¶ä»–æœåŠ¡å¯¹æ¯”**:
- OpenAI GPT-4: Â¥0.30/1Kè¾“å…¥ tokens (æ›´è´µ)
- Claude: Â¥0.50/1Mè¾“å…¥ tokens (éœ€ç¿»å¢™)
- DeepSeek: Â¥0.14/1Mè¾“å…¥ tokens (æœ€ä¾¿å®œï¼Œå›½å†…å¯ç”¨)

---

## é˜¿é‡Œäº‘ TTS é…ç½®

### 1. ç”³è¯·æœåŠ¡

**å®˜ç½‘**: https://www.aliyun.com/

**æ­¥éª¤**:
1. ç™»å½•é˜¿é‡Œäº‘è´¦å· (æ²¡æœ‰åˆ™æ³¨å†Œ)
2. è¿›å…¥ã€Œæ™ºèƒ½è¯­éŸ³äº¤äº’ã€æœåŠ¡
3. ç‚¹å‡»ã€Œå¼€é€šæœåŠ¡ã€
4. è¿›å…¥ API Key ç®¡ç†
5. åˆ›å»ºæ–°çš„ã€ŒAccess Keyã€

### 2. è·å–å‡­è¯

**åˆ›å»º Access Key**:
1. åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ï¼Œè¿›å…¥ã€Œè®¿é—®æ§åˆ¶ã€
2. ç‚¹å‡»ã€Œåˆ›å»º Access Keyã€
3. ä¿å­˜ **Access Key ID** å’Œ **Access Key Secret**

### 3. åç«¯é…ç½®

**æ›´æ–°æ–‡ä»¶**: `backend/.env.local`

```env
# é˜¿é‡Œäº‘ TTS é…ç½®
ALIYUN_ACCESSKEY_ID=your_access_key_id
ALIYUN_ACCESSKEY_SECRET=your_access_key_secret
ALIYUN_TTS_REGION=cn-hangzhou
ALIYUN_TTS_ENDPOINT=nls-gateway-cn-shenzhen.aliyuncs.com
ALIYUN_TTS_VOICE=xiaoxiao  # è¯­éŸ³è§’è‰²

# è…¾è®¯äº‘ TTS å¤‡é€‰é…ç½®
TENCENT_TTS_ENABLED=false
TENCENT_SECRET_ID=your_secret_id
TENCENT_SECRET_KEY=your_secret_key
```

### 4. åç«¯é›†æˆ

```typescript
// src/services/tts.service.ts
import { Injectable } from '@nestjs/common';
import * as NLS from '@alicloud/nls-sdk';

@Injectable()
export class TtsService {
  private client: NLS.SpeechSynthesizer;

  constructor() {
    this.client = new NLS.SpeechSynthesizer({
      accessKeyId: process.env.ALIYUN_ACCESSKEY_ID,
      accessKeySecret: process.env.ALIYUN_ACCESSKEY_SECRET,
      appKey: process.env.ALIYUN_APP_KEY,
      region: process.env.ALIYUN_TTS_REGION,
    });
  }

  async synthesize(
    text: string,
    voice: string = 'xiaoxiao',
  ): Promise<Buffer> {
    try {
      const result = await this.client.synthesize({
        text,
        voice,
        format: 'mp3',
        sampleRate: 16000,
      });

      return result;
    } catch (error) {
      console.error('TTS synthesis error:', error);
      throw new Error('è¯­éŸ³åˆæˆå¤±è´¥');
    }
  }

  async synthesizeChapter(
    chapterContent: string,
    chapterId: string,
  ): Promise<string> {
    // è¿”å›ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶URL (ä¸Šä¼ åˆ°OSS)
    const audioBuffer = await this.synthesize(chapterContent);
    const uploadUrl = await this.uploadToOss(
      audioBuffer,
      `audio/chapter_${chapterId}.mp3`,
    );
    return uploadUrl;
  }

  private async uploadToOss(buffer: Buffer, key: string): Promise<string> {
    // ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS
    // è¿”å›å…¬å¼€ URL
    return `https://oss.example.com/${key}`;
  }
}
```

### 5. æ”¯æŒçš„è¯­éŸ³

```
å°å° (xiaoxiao): å¥³å£°ï¼Œæ¸©æŸ”
å¤§å® (dabao): ç”·å£°ï¼Œä½æ²‰
èè (sasha): å¥³å£°ï¼Œæ´»æ³¼
èµµç³ (zhaolin): å¥³å£°ï¼Œæ ‡å‡†æ™®é€šè¯
```

---

## å¾®ä¿¡å°ç¨‹åºé…ç½®

### 1. æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°è´¦å·

**å®˜ç½‘**: https://mp.weixin.qq.com/

**æµç¨‹**:
1. è®¿é—®å¾®ä¿¡å…¬ä¼—å¹³å°
2. ç‚¹å‡»ã€Œç«‹å³æ³¨å†Œã€
3. é€‰æ‹©ã€Œå°ç¨‹åºã€
4. å¡«å†™åŸºæœ¬ä¿¡æ¯å¹¶éªŒè¯
5. è·å¾— **AppID** å’Œ **AppSecret**

### 2. å°ç¨‹åºåŸºæœ¬é…ç½®

**ä¿å­˜ AppID å’Œ AppSecret**:

```env
WECHAT_APPID=wx1234567890abcdef
WECHAT_APPSECRET=abcdef1234567890abcdef1234567890
```

### 3. åç«¯é…ç½®

**æ›´æ–°æ–‡ä»¶**: `backend/.env.local`

```env
# å¾®ä¿¡å°ç¨‹åºé…ç½®
WECHAT_APPID=wx1234567890abcdef
WECHAT_APPSECRET=abcdef1234567890abcdef1234567890
WECHAT_API_URL=https://api.weixin.qq.com

# å¾®ä¿¡ç™»å½•é…ç½®
WECHAT_LOGIN_ENABLED=true
WECHAT_OAUTH_CALLBACK=https://yourdomain.com/auth/wechat-callback
```

### 4. å¾®ä¿¡è®¤è¯é…ç½®

**é…ç½®æœåŠ¡å™¨åœ°å€**:
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
2. è¿›å…¥ã€Œè®¾ç½® > åŸºæœ¬è®¾ç½®ã€
3. æ‰¾åˆ°ã€ŒæœåŠ¡å™¨åœ°å€ã€
4. å¡«å…¥ä½ çš„æœåŠ¡å™¨åœ°å€: `https://yourdomain.com/api/wechat`
5. Token: è‡ªå®šä¹‰ (å¦‚: `reading_app_token`)
6. EncodingAESKey: è‡ªåŠ¨ç”Ÿæˆ

**æ›´æ–°åç«¯**:

```env
WECHAT_VERIFY_TOKEN=reading_app_token
WECHAT_ENCODING_AES_KEY=your_encoding_aes_key
```

### 5. å‰ç«¯é…ç½®

**æ›´æ–°æ–‡ä»¶**: `frontend/.env.development`

```env
TARO_APP_WECHAT_APPID=wx1234567890abcdef
TARO_APP_API_BASE=http://localhost:3000/api
```

### 6. è·å–å¾®ä¿¡æˆæƒcode

```typescript
// frontend/src/services/wechat.ts
import Taro from '@tarojs/taro';

export const getWechatAuthCode = async (): Promise<string> => {
  const res = await Taro.login();
  return res.code;  // ç”¨äºåç«¯æ¢å– access_token
};

export const getUserInfo = async () => {
  const res = await Taro.getUserInfo({
    withCredentials: true,
  });
  return {
    rawData: res.rawData,
    signature: res.signature,
    encryptedData: res.encryptedData,
    iv: res.iv,
  };
};
```

---

## æ•°æ®åº“é…ç½®

### 1. æœ¬åœ° PostgreSQL è®¾ç½®

**ä½¿ç”¨ Docker Compose**:

```yaml
# docker-compose.yml
version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    container_name: reading_postgres
    environment:
      POSTGRES_USER: reading_user
      POSTGRES_PASSWORD: secure_password_123
      POSTGRES_DB: reading_db
    ports:
      - '5432:5432'
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U reading_user']
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
```

**å¯åŠ¨æ•°æ®åº“**:

```bash
docker-compose up -d postgres
# éªŒè¯è¿æ¥
psql -h localhost -U reading_user -d reading_db
```

### 2. Prisma é…ç½®

**æ›´æ–°æ–‡ä»¶**: `backend/.env.local`

```env
# æ•°æ®åº“è¿æ¥
DATABASE_URL=postgresql://reading_user:secure_password_123@localhost:5432/reading_db?schema=public
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

```bash
cd backend

# ç”Ÿæˆ Prisma Client
npx prisma generate

# åˆ›å»ºåˆå§‹è¿ç§»
npx prisma migrate dev --name init

# å¡«å……ç¤ºä¾‹æ•°æ® (å¯é€‰)
npx ts-node scripts/seed.ts
```

### 4. è¿æ¥éªŒè¯

```bash
# ä½¿ç”¨ psql è¿æ¥
psql -h localhost -U reading_user -d reading_db

# æŸ¥çœ‹è¡¨
\dt

# æŸ¥çœ‹è¡¨ç»“æ„
\d "User"
```

---

## Redis é…ç½®

### 1. æœ¬åœ° Redis è®¾ç½®

**æ›´æ–° docker-compose.yml**:

```yaml
services:
  redis:
    image: redis:7-alpine
    container_name: reading_redis
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  redis_data:
```

**å¯åŠ¨ Redis**:

```bash
docker-compose up -d redis
# éªŒè¯
redis-cli ping
# è¾“å‡º: PONG
```

### 2. åç«¯é…ç½®

**æ›´æ–°æ–‡ä»¶**: `backend/.env.local`

```env
# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # æœ¬åœ°å¼€å‘å¯ç•™ç©º
REDIS_DB=0

# ç¼“å­˜é…ç½®
CACHE_TTL=3600  # 1å°æ—¶
CACHE_ENABLED=true
```

### 3. ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹

```typescript
// src/services/cache.service.ts
import { Injectable } from '@nestjs/common';
import { RedisService } from '@liaoliaots/nestjs-redis';

@Injectable()
export class CacheService {
  constructor(private redis: RedisService) {}

  async set(
    key: string,
    value: any,
    ttl: number = 3600,
  ): Promise<void> {
    const client = this.redis.getClient();
    await client.setex(key, ttl, JSON.stringify(value));
  }

  async get<T>(key: string): Promise<T | null> {
    const client = this.redis.getClient();
    const value = await client.get(key);
    return value ? JSON.parse(value) : null;
  }

  async invalidate(pattern: string): Promise<void> {
    const client = this.redis.getClient();
    const keys = await client.keys(pattern);
    if (keys.length > 0) {
      await client.del(...keys);
    }
  }
}
```

---

## ç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. é˜¿é‡Œäº‘ ECS éƒ¨ç½²

**è´­ä¹° ECS å®ä¾‹**:
- é…ç½®: 2æ ¸ 4GB (å…¥é—¨) æˆ– 4æ ¸ 8GB (æ¨è)
- ç³»ç»Ÿ: Ubuntu 20.04 LTS
- åœ°åŸŸ: é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°åŸŸ

### 2. ç¯å¢ƒå˜é‡è®¾ç½®

**åœ¨ ECS ä¸Šåˆ›å»º**: `/etc/environment`

```env
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000

# æ•°æ®åº“
DATABASE_URL=postgresql://prod_user:secure_password@rds.aliyuncs.com:5432/reading_prod

# Redis
REDIS_HOST=redis.aliyuncs.com
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# DeepSeek
DEEPSEEK_API_KEY=sk_production_key

# é˜¿é‡Œäº‘
ALIYUN_ACCESSKEY_ID=your_prod_access_key
ALIYUN_ACCESSKEY_SECRET=your_prod_secret

# å¾®ä¿¡
WECHAT_APPID=wx_production_id
WECHAT_APPSECRET=wx_production_secret

# æ—¥å¿—
LOG_LEVEL=info
LOG_DIR=/var/log/reading-app
```

### 3. SSL/HTTPS é…ç½®

**ç”³è¯· SSL è¯ä¹¦** (é˜¿é‡Œäº‘):
1. è¿›å…¥ã€ŒSSLè¯ä¹¦ã€æœåŠ¡
2. ç”³è¯·å…è´¹è¯ä¹¦æˆ–è´­ä¹°å•†ä¸šè¯ä¹¦
3. å®ŒæˆåŸŸåéªŒè¯

**Nginx é…ç½®**:

```nginx
# /etc/nginx/sites-available/reading-app

upstream reading_backend {
  server 127.0.0.1:3000;
}

server {
  listen 80;
  server_name yourdomain.com www.yourdomain.com;

  # é‡å®šå‘åˆ° HTTPS
  return 301 https://$server_name$request_uri;
}

server {
  listen 443 ssl http2;
  server_name yourdomain.com www.yourdomain.com;

  ssl_certificate /etc/ssl/certs/yourdomain.com.crt;
  ssl_certificate_key /etc/ssl/private/yourdomain.com.key;

  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers on;

  location /api {
    proxy_pass http://reading_backend;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location / {
    root /var/www/reading-app;
    index index.html;
    try_files $uri $uri/ /index.html;
  }
}
```

### 4. è‡ªåŠ¨å¤‡ä»½é…ç½®

```bash
#!/bin/bash
# scripts/backup.sh

BACKUP_DIR="/var/backups/reading-app"
DATE=$(date +%Y%m%d_%H%M%S)

# å¤‡ä»½æ•°æ®åº“
pg_dump reading_prod | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz /var/data/reading-app/uploads

# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: DeepSeek API è¿æ¥å¤±è´¥

**é”™è¯¯æ—¥å¿—**:
```
Error: connect ETIMEDOUT
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥ (å›½å†…ç”¨æˆ·å¯èƒ½éœ€è¦ç‰¹æ®Šç½‘ç»œ)
3. æ£€æŸ¥ API URL æ˜¯å¦æ­£ç¡®
4. å¢åŠ è¶…æ—¶æ—¶é—´ (DEEPSEEK_TIMEOUT)

```bash
# æµ‹è¯•è¿æ¥
curl -X POST https://api.deepseek.com/v1/chat/completions \
  -H "Authorization: Bearer your_api_key" \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-chat","messages":[{"role":"user","content":"hello"}]}'
```

### é—®é¢˜ 2: é˜¿é‡Œäº‘ TTS è¿”å›é”™è¯¯

**é”™è¯¯**:
```
TtsServiceUnavailable: Service unavailable
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Access Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ Region æ˜¯å¦æ­£ç¡® (cn-hangzhou)
3. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¼€é€š
4. ä½¿ç”¨è…¾è®¯äº‘ä½œä¸ºå¤‡é€‰

### é—®é¢˜ 3: PostgreSQL è¿æ¥å¤±è´¥

**é”™è¯¯**:
```
FATAL: no password supplied
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ DATABASE_URL æ ¼å¼
echo $DATABASE_URL
# åº”è¯¥æ˜¯: postgresql://user:password@host:5432/database

# æµ‹è¯•è¿æ¥
psql $DATABASE_URL -c "SELECT 1"
```

### é—®é¢˜ 4: Prisma è¿ç§»å¤±è´¥

**é”™è¯¯**:
```
Migration failed, database is locked
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡ç½®è¿ç§»çŠ¶æ€
npx prisma migrate resolve --rolled-back

# æ£€æŸ¥è¿ç§»å†å²
npx prisma migrate status

# é‡æ–°åº”ç”¨è¿ç§»
npx prisma migrate dev
```

### é—®é¢˜ 5: å°ç¨‹åºæ— æ³•è¿æ¥åç«¯

**é”™è¯¯**:
```
Request failed: Cannot reach server
```

**æ£€æŸ¥æ¸…å•**:
- [ ] åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œä¸­ (`curl http://localhost:3000/health`)
- [ ] å‰ç«¯é…ç½®çš„ API_BASE æ˜¯å¦æ­£ç¡®
- [ ] å¾®ä¿¡å°ç¨‹åºæ˜¯å¦åœ¨åˆæ³•åŸŸååˆ—è¡¨ä¸­
- [ ] HTTPS è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ

**é…ç½®åˆæ³•åŸŸå**:
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
2. è¿›å…¥ã€Œå¼€å‘ > å¼€å‘è®¾ç½®ã€
3. åœ¨ã€ŒæœåŠ¡å™¨åŸŸåã€ä¸­æ·»åŠ ä½ çš„åŸŸå

---

## éªŒè¯æ¸…å•

å¯åŠ¨é¡¹ç›®å‰ï¼Œç¡®ä¿ä»¥ä¸‹é¡¹ç›®éƒ½å·²å®Œæˆ:

- [ ] Node.js 18+ å·²å®‰è£…
- [ ] DeepSeek API Key å·²è·å–å¹¶é…ç½®
- [ ] é˜¿é‡Œäº‘ Access Key å·²è·å–å¹¶é…ç½®
- [ ] å¾®ä¿¡ AppID/AppSecret å·²è·å–å¹¶é…ç½®
- [ ] PostgreSQL æ•°æ®åº“å·²å¯åŠ¨ (`docker-compose up -d`)
- [ ] Redis å·²å¯åŠ¨ (`redis-cli ping` è¿”å› PONG)
- [ ] `.env.local` æ–‡ä»¶å·²å®Œæ•´é…ç½®
- [ ] Prisma è¿ç§»å·²å®Œæˆ (`npx prisma migrate dev`)
- [ ] åç«¯ä¾èµ–å·²å®‰è£… (`npm install` in backend/)
- [ ] å‰ç«¯ä¾èµ–å·²å®‰è£… (`npm install` in frontend/)
- [ ] æ‰€æœ‰é…ç½®çš„ API Key éƒ½èƒ½è®¿é—® (æ— åœ°åŒºé™åˆ¶)

---

**ç»´æŠ¤è€…**: DevOps å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-10-25
